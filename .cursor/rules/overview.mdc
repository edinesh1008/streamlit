---
description:
globs:
alwaysApply: true
---

# Streamlit Repo Overview

## Folder Structure

- `lib/`: All backend code and assets.
- `lib/streamlit/`: The main Streamlit library package.
- `lib/streamlit/elements/`: Backend code of elements and widgets.
- `lib/tests`: Python unit tests.
- `frontend/`: All frontend code and assets.
- `frontend/app/`: Streamlit application UI.
- `frontend/lib/`: Shared TS library that contains elements, widgets, and layouts.
- `frontend/utils/`: Shared utils.
- `frontend/connection/`: WebSocket connection handling logic.
- `proto/`: Protobuf definitions for client-server communication.
- `e2e_playwright/`: E2E tests using playwright.
- `scripts/`: Utility scripts for development and CI/CD.
- `component-lib/`: Library for building custom components.

## Python environment

- Ensure a venv is active before running Python commands for the first time when opening a new terminal. If `$VIRTUAL_ENV` is already set, do not re-activate.
- Preferred location: `<repo_root>/lib/venv`. Activate with: `source "$(git rev-parse --show-toplevel 2>/dev/null || pwd)/lib/venv/bin/activate"`.
- If not active, try in order: `<repo_root>/lib/venv`, `<repo_root>/.venv`, `<repo_root>/venv`. If none found, ask the user.

## Test execution

- Prefer running a specific test or test file while iterating; avoid full-suite runs unless necessary.
- Python unit: `PYTHONPATH=lib pytest lib/tests/streamlit/<path_to_test>.py`
- Frontend unit: `cd frontend && yarn vitest <workspace_path_to_test>.test.tsx`
- E2E (Playwright): `make run-e2e-test e2e_playwright/<test_file>.py`

## `make` commands

Selection of `make` commands executable from root relevant for development:

help                       Show all available commands.
protobuf                   Recompile Protobufs for Python and the frontend.
python-lint                Lint and check formatting of Python files.
python-tests               Run all Python unit tests.
python-types               Run the Python type checker.
frontend-fast              Build the frontend.
frontend-dev               Start the frontend development server.
frontend-lint              Lint and check formatting of frontend files.
frontend-types             Run the frontend type checker.
frontend-format            Format frontend files.
frontend-tests             Run all frontend unit tests.
autofix                    Autofix linting and formatting errors.
debug-e2e-test             Run e2e test in debug mode, via: `make debug-e2e-test st_command_test.py`.
run-e2e-test               Run e2e test, via: `make run-e2e-test st_command_test.py`.
